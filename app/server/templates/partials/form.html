{{define "form"}}
<div class="modal-header">
    <h2>{{if .IsNew}}Create Key{{else}}Edit Key{{end}}</h2>
    <button class="modal-close" onclick="hideModal('main-modal')">&times;</button>
</div>
<form {{if .IsNew}}hx-post="{{.BaseURL}}/web/keys"{{else}}hx-put="{{.BaseURL}}/web/keys/{{.Key | urlEncode}}"{{end}}
      hx-target="#keys-table"
      hx-swap="innerHTML"
      data-close-modal>
    <div class="modal-body">
        {{if .Error}}
        <div class="error-message" id="form-error">{{.Error}}</div>
        {{end}}
        <div class="form-group">
            <label for="key">Key</label>
            <input type="text" id="key" name="key" value="{{.Key}}"
                   {{if not .IsNew}}readonly{{end}}
                   placeholder="e.g., app/config/database"
                   oninput="var e=document.getElementById('form-error');if(e)e.remove()"
                   required>
            {{if .IsNew}}
            <div class="form-hint">Use slashes to organize keys hierarchically</div>
            {{end}}
        </div>
        <div class="form-group">
            <label for="value">Value</label>
            {{if .IsBinary}}
            <span class="binary-indicator">Base64 encoded</span>
            <input type="hidden" name="is_binary" value="true">
            {{end}}
            <textarea id="value" name="value" placeholder="Enter value..."
                      oninput="var e=document.getElementById('form-error');if(e)e.remove()"
                      required>{{.Value}}</textarea>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="hideModal('main-modal')">Cancel</button>
        <button type="submit" class="btn btn-primary">{{if .IsNew}}Create{{else}}Save{{end}}</button>
    </div>
</form>
{{if not .IsNew}}
<style>
    #main-modal .modal { --modal-width: {{.ModalWidth}}px; }
    #main-modal textarea#value { min-height: {{.TextareaHeight}}px; }
</style>
{{end}}
{{end}}
