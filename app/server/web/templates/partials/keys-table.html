{{define "keys-table"}}
{{if .Keys}}
{{if eq .ViewMode "cards"}}
<div class="cards-container">
    {{range .Keys}}
    <div class="key-card"
         hx-get="{{$.BaseURL}}/web/keys/view/{{.Key | urlEncode}}"
         hx-target="#modal-content"
         hx-swap="innerHTML">
        <div class="key-card-header">
            <span class="key-card-name">{{.Key}}</span>
        </div>
        <div class="key-card-meta">
            <span>{{.Size | formatSize}}</span>
            <span>Updated: {{.UpdatedAt | formatTime}}</span>
        </div>
        {{if .CanWrite}}
        <div class="key-card-actions" onclick="event.stopPropagation()">
            <button class="btn btn-edit btn-small"
                    hx-get="{{$.BaseURL}}/web/keys/edit/{{.Key | urlEncode}}"
                    hx-target="#modal-content"
                    hx-swap="innerHTML">Edit</button>
            <button class="btn btn-danger btn-small"
                    onclick="showConfirmDelete('{{.Key | js}}', '{{$.BaseURL}}/web/keys/{{.Key | urlEncode}}')">Delete</button>
        </div>
        {{end}}
    </div>
    {{end}}
</div>
{{else}}
<table>
    <thead>
        <tr>
            <th>Key</th>
            <th>Size</th>
            <th>Updated</th>
            <th>Created</th>
            {{if $.CanWrite}}<th class="actions-cell">Action</th>{{end}}
        </tr>
    </thead>
    <tbody>
        {{range .Keys}}
        <tr class="clickable-row"
            hx-get="{{$.BaseURL}}/web/keys/view/{{.Key | urlEncode}}"
            hx-target="#modal-content"
            hx-swap="innerHTML"
            hx-trigger="click target:td:not(.actions-cell)">
            <td class="key-cell">{{.Key}}</td>
            <td class="size-cell">{{.Size | formatSize}}</td>
            <td class="date-cell">{{.UpdatedAt | formatTime}}</td>
            <td class="date-cell">{{.CreatedAt | formatTime}}</td>
            {{if $.CanWrite}}
            <td class="actions-cell">
                {{if .CanWrite}}
                <button class="btn btn-edit btn-small"
                        hx-get="{{$.BaseURL}}/web/keys/edit/{{.Key | urlEncode}}"
                        hx-target="#modal-content"
                        hx-swap="innerHTML">Edit</button>
                <button class="btn btn-danger btn-small"
                        onclick="showConfirmDelete('{{.Key | js}}', '{{$.BaseURL}}/web/keys/{{.Key | urlEncode}}')">Delete</button>
                {{end}}
            </td>
            {{end}}
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}
<span id="key-count" hx-swap-oob="innerHTML" style="display:none">{{.TotalKeys}} {{if eq .TotalKeys 1}}key{{else}}keys{{end}}{{if .Search}} matching "{{.Search}}"{{end}}</span>
<span id="sort-label" hx-swap-oob="innerHTML" style="display:none">{{.SortMode | sortModeLabel}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination">
    {{if gt .TotalPages 1}}
    <button class="btn-page{{if not .HasPrev}} disabled{{end}}"
            {{if .HasPrev}}hx-get="{{.BaseURL}}/web/keys?page={{sub .Page 1}}"
            hx-target="#keys-table"
            hx-swap="innerHTML"
            hx-include="[name='search']"{{end}}>&#8249;</button>
    <span class="page-info">{{.Page}} / {{.TotalPages}}</span>
    <button class="btn-page{{if not .HasNext}} disabled{{end}}"
            {{if .HasNext}}hx-get="{{.BaseURL}}/web/keys?page={{add .Page 1}}"
            hx-target="#keys-table"
            hx-swap="innerHTML"
            hx-include="[name='search']"{{end}}>&#8250;</button>
    {{end}}
</span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="{{.Page}}">
{{else if .Search}}
<div class="empty-state">
    <p>No keys matching "{{.Search}}"</p>
</div>
<span id="key-count" hx-swap-oob="innerHTML" style="display:none">no keys matching "{{.Search}}"</span>
<span id="sort-label" hx-swap-oob="innerHTML" style="display:none">{{.SortMode | sortModeLabel}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination"></span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="1">
{{else}}
<div class="empty-state">
    <p>No keys stored yet</p>
    {{if .CanWrite}}
    <button class="btn btn-primary"
            hx-get="{{.BaseURL}}/web/keys/new"
            hx-target="#modal-content"
            hx-swap="innerHTML">
        Create your first key
    </button>
    {{end}}
</div>
<span id="key-count" hx-swap-oob="innerHTML" style="display:none">no keys</span>
<span id="sort-label" hx-swap-oob="innerHTML" style="display:none">{{.SortMode | sortModeLabel}}</span>
<span id="pagination" hx-swap-oob="outerHTML" class="pagination"></span>
<input type="hidden" id="current-page" hx-swap-oob="outerHTML" name="page" value="1">
{{end}}
{{end}}
